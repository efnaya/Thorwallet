"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3176],{70275:function(e,t,n){n.d(t,{P:function(){return b}});var r=n(44431),a=n.n(r),o=n(91261),c=n(67294),s=n(59499),i=n(23925),u=n(29046),l=n(30909),f=n(85893);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var d=(0,i.default)((function(e){return(0,f.jsx)(o.Yz,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){(0,s.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e))})).withConfig({displayName:"AmountLabel__Wrapper",componentId:"sc-bv0510-0"})(["background:rgba(255,255,255,0.15);border-radius:14px;padding:4px 12px;margin:0 6px;cursor:pointer;& p{color:",";}",""],u.Rl.textDark,(function(e){return e.active&&"\n    background: #FFFFFF;\n  "})),m=function(e){var t=e.label,n=e.onClick,r=(e.isMax,e.active);return(0,f.jsx)(d,{justifyContent:"center",alignItems:"center",onClick:n,active:r,children:"string"!==typeof t?t:(0,f.jsx)(l.VY,{size:"s",margin:"0",children:t})})},b=function(e){var t=e.onMultiply,n=e.activeMultiplyer,r=e.setActiveMultiplyer,s=e.show100Percent,i=e.setInsertMode,u=(0,c.useCallback)((function(e){i&&i("crypto"),t(new(a())(e)),r(e)}),[t]);return(0,f.jsxs)(o.kC,{justifyContent:"center",alignItems:"center",style:{marginLeft:"-6px",marginBottom:"10px"},children:[(0,f.jsx)(m,{onClick:function(){return u(.25)},label:"25%",active:.25===n}),(0,f.jsx)(m,{onClick:function(){return u(.5)},label:"50%",active:.5===n}),(0,f.jsx)(m,{onClick:function(){return u(.75)},label:"75%",active:.75===n}),s&&(0,f.jsx)(m,{onClick:function(){return u(1)},label:"Max",active:1===n})]})}},24325:function(e,t,n){n.d(t,{u:function(){return v}});var r=n(17674),a=n(48771),o=n(44431),c=n.n(o),s=n(91261),i=n(67294),u=n(29046),l=n(30909),f=n(601),p=n(85081),d=n(26036),m=n(46383),b=n(85893),v=function(e){var t=e.balance,n=e.assetDetails,o=(0,m.L)("conversionRate"),v=(0,r.Z)(o,1)[0],g=(t.amount&&(0,p.ui)((0,a.Bo)(t.amount),n.assetPriceUSD,v),(0,i.useMemo)((function(){return t.amount.eq(new(c())(0))?"0":t.amount.gte(new(c())(1e3))?(0,d.Y)((0,f.az)(t),{forceAtLeastTwoDigits:!0,separator:","}):t.amount.amount().toFixed(2)}),[t]));return(0,b.jsx)(s.kC,{alignItems:"center",justifyContent:"center",children:(0,b.jsxs)(l.FE,{color:u.Rl.TRANSPARENT_WHITE,size:"xs",children:["Balance: ",g," ",t.asset.ticker]})})}},95531:function(e,t,n){n.d(t,{R:function(){return B}});var r,a=n(59499),o=n(50029),c=n(17674),s=n(87794),i=n.n(s),u=n(67294);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l.apply(this,arguments)}var f=function(e){return u.createElement("svg",l({"aria-hidden":"true","data-prefix":"fal","data-icon":"file-signature",className:"approve_svg__svg-inline--fa approve_svg__fa-file-signature approve_svg__fa-w-18",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 576 512"},e),r||(r=u.createElement("path",{fill:"currentColor",d:"m560.83 135.96-24.79-24.79c-20.23-20.24-53-20.26-73.26 0L384 189.72v-57.75c0-12.7-5.1-25-14.1-33.99L286.02 14.1c-9-9-21.2-14.1-33.89-14.1H47.99C21.5.1 0 21.6 0 48.09v415.92C0 490.5 21.5 512 47.99 512h288.02c26.49 0 47.99-21.5 47.99-47.99v-80.54c6.29-4.68 12.62-9.35 18.18-14.95l158.64-159.3c9.79-9.78 15.17-22.79 15.17-36.63s-5.38-26.84-15.16-36.63zM256.03 32.59c2.8.7 5.3 2.1 7.4 4.2l83.88 83.88c2.1 2.1 3.5 4.6 4.2 7.4h-95.48V32.59zm95.98 431.42c0 8.8-7.2 16-16 16H47.99c-8.8 0-16-7.2-16-16V48.09c0-8.8 7.2-16.09 16-16.09h176.04v104.07c0 13.3 10.7 23.93 24 23.93h103.98v61.53l-48.51 48.24c-30.14 29.96-47.42 71.51-47.47 114-3.93-.29-7.47-2.42-9.36-6.27-11.97-23.86-46.25-30.34-66-14.17l-13.88-41.62c-3.28-9.81-12.44-16.41-22.78-16.41s-19.5 6.59-22.78 16.41L103 376.36c-1.5 4.58-5.78 7.64-10.59 7.64H80c-8.84 0-16 7.16-16 16s7.16 16 16 16h12.41c18.62 0 35.09-11.88 40.97-29.53L144 354.58l16.81 50.48c4.54 13.51 23.14 14.83 29.5 2.08l7.66-15.33c4.01-8.07 15.8-8.59 20.22.34C225.44 406.61 239.9 415.7 256 416h32c22.05-.01 43.95-4.9 64.01-13.6v61.61zm27.48-118.05A129.012 129.012 0 0 1 288 384v-.03c0-34.35 13.7-67.29 38.06-91.51l120.55-119.87 52.8 52.8-119.92 120.57zM538.2 186.6l-21.19 21.19-52.8-52.8 21.2-21.19c7.73-7.73 20.27-7.74 28.01 0l24.79 24.79c7.72 7.73 7.72 20.27-.01 28.01z"})))},p=n(80101),d=n(91261),m=n(14660),b=n(22538),v=n(29046),g=n(30909),x=n(13395),h=(0,x.p)(1e9,18),w=n(24497),k=n(17172),y=n(15737),j=n(17766),C=n(8137),O=n(60028),A=n(32141),E=n(14198),P=n(12895),T=n(41018),S=n(37658),F=n(48771),_=n(43037),D=n(32622),M=n(75204),I=n(85893),R=function(e){var t=e.txs,n=e.pendingTransactionId,r=e.assets,a=(0,u.useMemo)((function(){return t.filter((function(e){return"error"===e.broadcastType})).length>0}),[t]);return(0,I.jsxs)(d.kC,{flexFlow:"column nowrap",children:[(0,I.jsx)(M._,{txs:t,assets:r,pendingTransactionId:n}),a?null:(0,I.jsxs)(d.kC,{flexFlow:"column nowrap",children:[(0,I.jsx)(g.FE,{size:"xs",children:"We are looking for your transaction."}),(0,I.jsx)(g.FE,{size:"xs",children:"After contract allowance is confirmed, you will be automatically redirected."})]})]})},N=function(e){var t=e.txs,n=e.action,r=e.from,a=e.fromAmount,s=e.type,l=e.assetToApprove,f=e.setStep,p=function(e){var t=e.asset,n=e.timer,r=e.amount,a=e.isFocused,s=(0,u.useRef)(!1),l=(0,P.$)("phrase"),f=(0,c.Z)(l,1)[0],p=(0,E.LN)("network"),d=(0,c.Z)(p,1)[0],m=(0,j.e)(),v=(0,D.L)(),g=(0,u.useState)("loading"),x=g[0],h=g[1],w=(0,b.Ru)(),k=(0,u.useCallback)((0,o.Z)(i().mark((function e(){var n,o,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m){e.next=2;break}return e.abrupt("return");case 2:if(f||w.walletType!==b.Sq.Phrase){e.next=4;break}return e.abrupt("return");case 4:if(!s.current){e.next=6;break}return e.abrupt("return");case 6:if(a){e.next=8;break}return e.abrupt("return");case 8:return e.prev=8,h("loading"),e.next=12,m.getAddress(d,F.qo.Ethereum);case 12:if(n=e.sent,o=void 0,f||(o=m.getWallet(F.qo.Ethereum,n)),"TGT"!==t.ticker){e.next=29;break}return e.t1=_.IB,e.t2=f||"",e.t3=d,e.next=21,m.getAddress(d,F.qo.Ethereum);case 21:return e.t4=e.sent,e.t5=o,e.t6={phrase:e.t2,network:e.t3,owner:e.t4,wallet:e.t5},e.next=26,(0,e.t1)(e.t6);case 26:e.t0=e.sent,e.next=41;break;case 29:return e.t7=m,e.t8=t,e.t9=v,e.next=34,m.getAddress(d,F.qo.Ethereum);case 34:return e.t10=e.sent,e.t11=f||"",e.t12=d,e.t13={fromAsset:e.t8,inboundAddresses:e.t9,address:e.t10,phrase:e.t11,network:e.t12},e.next=40,e.t7.getThorchainContractAllowance.call(e.t7,e.t13);case 40:e.t0=e.sent;case 41:c=e.t0,console.log("Checking allowance for asset ".concat(t.ticker),c.amount()),h((function(){return c.gte(r.amount())?"allowed":"not-allowed"})),e.next=50;break;case 46:e.prev=46,e.t14=e.catch(8),console.log("allowance call bug",String(e.t14)),h("not-allowed");case 50:case"end":return e.stop()}}),e,null,[[8,46]])}))),[r,t,m,v,a,d,f]);return(0,u.useEffect)((function(){k();var e=setInterval((function(){k()}),n);return function(){return clearInterval(e)}}),[k,n]),(0,u.useEffect)((function(){return s.current=!1,function(){s.current=!0}}),[]),(0,u.useMemo)((function(){return{contractAllowance:x}}),[x])}({asset:r.asset,amount:a,timer:12e3,isFocused:!0}),d=p.contractAllowance,m=(0,u.useMemo)((function(){if("approve-contract"===s)return[l];throw new Error("Params in AllowancePendingTransactionScreen are wrong")}),[s]);return(0,u.useEffect)((function(){"allowed"===d&&f(3)}),[d]),(0,u.useMemo)((function(){return(0,I.jsx)(R,{pendingTransactionId:n,assets:m,txs:t})}),[n,m,t])},Z=n(84458);function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var B=function(e){var t=e.asset,n=e.amount,r=e.spender,a=e.onClickBack,s=e.from,l=e.setStep,F=(0,j.e)(),_=(0,P.$)("phrase"),D=(0,c.Z)(_,1)[0],M=(0,E.LN)("network"),R=(0,c.Z)(M,1)[0],z=(0,u.useState)(!1),B=z[0],q=z[1],H=(0,A.Q)("feeOptionKey"),W=(0,c.Z)(H,1)[0],U=(0,O.J)("prices"),$=(0,c.Z)(U,1)[0],V=(0,b.Ru)(),Y=(0,y.$)(),G=(0,u.useMemo)((function(){return(0,w.n)(t,60)}),[t]),J=function(e){var t=e.fromAsset,n=e.isFocused,r=e.spender,a=(0,E.LN)("network"),s=(0,c.Z)(a,1)[0],l=(0,u.useState)({type:"erc-20",state:"init"}),f=l[0],p=l[1],d=(0,j.e)(),m=(0,u.useCallback)((0,o.Z)(i().mark((function e(){var a,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d){e.next=2;break}return e.abrupt("return");case 2:if(n){e.next=4;break}return e.abrupt("return");case 4:return console.log("calculating erc20 approving fee",Date.now()),e.prev=5,p({type:"erc-20",state:"loading"}),e.next=9,T.J.getERC20ApproveFee({fromAsset:t,client:d,network:s,amount:h,spender:r});case 9:a=e.sent,o=a.fee,p({type:"erc-20",state:"success",feeTx:o}),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(5),console.log("useERC20ApproveFee error: ",String(e.t0)),p({type:"erc-20",state:"error",feeError:e.t0});case 18:case"end":return e.stop()}}),e,null,[[5,14]])}))),[d,t,r,n,s]);return(0,u.useEffect)((function(){m(),console.log("rendering erc20 approving fee",Date.now())}),[m]),(0,u.useMemo)((function(){return f}),[f])}({fromAsset:t,isFocused:!0,spender:r}),K=(0,u.useState)(1),Q=K[0],X=K[1],ee=(0,u.useState)([]),te=ee[0],ne=ee[1],re=(0,u.useCallback)((function(){J.state}),[n,t,J]),ae=(0,u.useCallback)((0,o.Z)(i().mark((function e(){var a,o,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(F){e.next=2;break}return e.abrupt("return");case 2:if(V.walletType!==b.Sq.Phrase||D){e.next=4;break}return e.abrupt("return");case 4:if("success"===J.state){e.next=6;break}return e.abrupt("return");case 6:return(0,m.L9)(m.eb.ACTION_WIDGET_SWAP_APPROVE_CONTRACT,{fromAsset:t.symbol}),q(!0),e.prev=8,e.next=11,F.approveERC20Contract({amount:h,fromAsset:t,fee:J.feeTx,feeOptionKey:W,phrase:D,network:R,gasPrices:$[t.chainId],nonce:(0,C.Po)(),spender:r});case 11:return a=e.sent,e.prev=12,e.t0=k._,e.t1=a.txHash,e.next=17,F.getAddress(R,t.chain);case 17:return e.t2=e.sent,e.t3=t,e.t4=t,e.t5=(0,x.p)(0,0),e.t6=Y.get(t).assetPriceUSD,e.t7=a.memo,e.t8={type:"approve-erc20",txHash:e.t1,fromAddress:e.t2,poolAsset:e.t3,fromAsset:e.t4,amount:e.t5,fromAssetPrice:e.t6,memo:e.t7},e.next=26,(0,e.t0)(e.t8);case 26:e.next=31;break;case 28:e.prev=28,e.t9=e.catch(12),console.log("could not send transaction stat to backend");case 31:o=[L(L({},{action:"approve-contract",balance:s,amount:n}),{},{tx:a,broadcastType:"not-error"})],ne(o),X(2),e.next=43;break;case 37:e.prev=37,e.t10=e.catch(8),c=[L(L({},{action:"approve-contract",balance:s,amount:n}),{},{error:e.t10,broadcastType:"error"})],ne(c),X(2);case 43:return e.prev=43,q(!1),e.finish(43);case 46:case"end":return e.stop()}}),e,null,[[8,37,43,46],[12,28]])}))),[F,D,J,R,W,t,$,r,Y]);return(0,I.jsxs)(I.Fragment,{children:[1===Q&&(0,I.jsxs)(d.kC,{flexFlow:"column nowrap",children:[(0,I.jsx)(p.Z,{width:16,fill:v.Rl.gray,style:{transform:"rotate(-90deg",alignSelf:"flex-start",cursor:"pointer"},onClick:a}),(0,I.jsxs)(S.c,{color:G.color,label:"Estimated Fee",fee:J,onPress:re,children:[(0,I.jsx)(f,{color:v.Rl.white,width:32,style:{marginTop:16}}),(0,I.jsxs)(g.d8,{children:["Approve ",t.ticker," Contract"]}),(0,I.jsxs)(g.FE,{size:"s",center:!0,color:v.Rl.TRANSPARENT_WHITE,style:{padding:16,paddingTop:0},children:["By approving ",t.ticker," you are allowing the Smart Contract to transfer the number of allowed tokens (called an allowance) when an action is executed on the contract."]})]}),"error"===J.state?(0,I.jsx)(Z.L,{error:J.feeError}):null,(0,I.jsx)(d.zx,{disabled:B||"success"!==J.state,onClick:ae,children:"Approve Contract"})]}),2===Q&&(0,I.jsx)(N,{txs:te,type:"approve-contract",action:"approve-contract",from:s,fromAmount:n,assetToApprove:s.asset,setStep:l})]})}},95445:function(e,t,n){n.d(t,{w:function(){return f}});var r=n(90116),a=n(44431),o=n(67294),c=n(96646),s=n(15737),i=n(29155),u=n(48771),l=n(47257),f=function(e){var t=e.balances,n=e.options,f=e.digits,p=e.setDigits,d=e.selectedIndex,m=e.setSelectedIndex;if(n.length!==f.length)throw new Error("options and digits need to be the same length: "+n.length+" vs "+f.length);var b=function(){var e=(0,s.$)(),t=(0,o.useCallback)((function(t,n,r){return"fiat"===t?n.filter(l.y).map((function(t){return(0,u.Bo)(t.amount).times(e.get(t.asset).assetPriceUSD)})).reduce((function(e,t){return e.plus(t)})).times(r):t.amount?(0,u.Bo)(t.amount).times(null!==r&&void 0!==r?r:"1"):{}}),[e]);return(0,o.useMemo)((function(){return{multiply:t}}),[t])}(),v=b.multiply,g=(0,i.u)(),x=(0,s.$)(),h=n[d];if(!h)throw new Error("amount grid doesnt have option");var w=(0,o.useMemo)((function(){var e="fiat"===h.balance?"fiat":h.balance.asset;return x.get(e).assetPriceUSD}),[x,h.balance]),k=(0,o.useCallback)((function(e,o){var c=n.map((function(e){return v(e.balance,t,1)}));if(w.eq(0))return e;var s=c.map((function(e,t){var r=n[t];if(!r)throw new Error("doesn't have usd value for options of index "+t);return g.convert({amount:e.amount().toString().split(""),base:"fiat"===r.balance?"fiat":r.balance.asset,to:"fiat"})})),i=a.BigNumber.min.apply(a.BigNumber,(0,r.Z)(s)),u=s.map((function(e){return a.BigNumber.min(1,i.div(e))}))[o];if(!u)throw new Error("no max multiplier for index "+o+" found");return u.times(e)}),[w,t,g,v,n]),y=(0,o.useCallback)((function(e){p((function(t){return t.map((function(t,r){if(d===r)return e;var a=n[r],o=n[d];if(!a||!o)throw new TypeError("doesn't have option for index "+r);var c="fiat"===o.balance?"fiat":o.balance.asset,s="fiat"===a.balance?"fiat":a.balance.asset,i="fiat"===s?2:Math.min(8,a.balance.amount.decimal);return g.convert({amount:e,base:c,to:s}).toNumber().toFixed(i).split("")}))}))}),[g,n,d,p]),j=(0,o.useCallback)((function(e){var n=k(e,d),r="fiat"===h.balance?2:Math.min(c.z9,h.balance.amount.decimal);y(v(h.balance,t,n).amount().toFixed(r).split(""))}),[t,k,v,y,h.balance,d]),C=(0,o.useCallback)((function(e){m(n.indexOf(e))}),[n,m]);return(0,o.useMemo)((function(){return{onOptionChange:C,onMultiply:j,option:h,assetInUSD:w,onDigits:y}}),[C,j,h,w,y])}}}]);